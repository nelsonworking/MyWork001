tinymce.PluginManager.add('moloImgUpload', function (editor, url) {
    function showDialog() {
        tinymce.activeEditor.windowManager.open({
            _prefix: '_moloImgUpload_',
            _form_id: this._prefix + 'myForm',
            _txt_file_id: this._prefix + 'myfile',
            title: '\u9078\u64C7\u8981\u4E0A\u50B3\u7684\u5716\u7247',
            width: 300,
            height: 100,
            resizable: "no",
            inline: "yes",
            close_previous: "no",
            html: '<form id="' + this._form_id + '" action="http://localhost/fdironstocking/addnewsimg.ashx" method="post" enctype="multipart/form-data"><input type="file" size="60" name="' + this._txt_file_id + '"></form>',
            buttons: [
                {
                    text: '\u78BA\u5B9A',
                    classes: 'widget btn primary first abs-layout-item',
                    onclick: function () {
                        var options = {
                            beforeSend: function () { },
                            uploadProgress: function (event, position, total, percentComplete) { },
                            success: function () { },
                            complete: function (response) {
                                var aa = response.responseText;
                                var obj = $.parseJSON(aa.replace('[', '').replace(']', ''));
                                editor.insertContent('<img src="' + obj.url + '" >');
                            },
                            error: function () { }
                        };
                        $("#" + this._form_id).ajaxForm(options);
                        $("#" + this._form_id).submit();
                        tinymce.activeEditor.windowManager.close();
                    }
                },
                {
                    text: '\u53D6\u6D88',
                    classes: 'widget btn first abs-layout-item',
                    onclick: 'close'
                }
            ]
        });
    }

    editor.addButton('moloImgUpload', {
        image: url + '/img/cloud-upload-20.png',
        tooltip: "\u63D2\u5165\u5716\u7247", // \u63D2\u5165\u5716\u7247 ==> ´¡¤J¹Ï¤ù
        onclick: showDialog,
        stateSelector: ['img[data-mce-object=video]', 'img[data-mce-object=iframe]']
    });

});