tinymce.PluginManager.add('moloYoutube', function (editor, url) {
	function showDialog() {
	    var selectedNode = editor.selection.getNode();

	    var getSrc = function () {
	        if (selectedNode.getAttribute('data-mce-p-src')) {
	            return selectedNode.getAttribute('data-mce-p-src');
	        }
	        return;
	    };

	    editor.windowManager.open({
			title: 'YouTube',
			body: [
                { type: 'label', text: '\u8ACB\u8F38\u5165\u0020\u0059\u006F\u0075\u0054\u0075\u0062\u0065\u0020\u5F71\u7247\u7DB2\u5740\u0020\u6216\u0020\u0059\u006F\u0075\u0054\u0075\u0062\u0065\u0020\u0043\u006F\u0064\u0065\u0020\u003A' },
                { type: 'textbox', name: 'name', size: 40, value: getSrc() }
			],

			onsubmit: function(e) {
			    var yburl = e.data.name;
			    if (yburl === null) { return; }

			    var code, regexRes;
			    regexRes = yburl.match("[\\?&]v=([^&#]*)");
			    code = (regexRes === null) ? yburl : regexRes[1];
			    if (code === "") { return; }

			    editor.insertContent(
                    '<iframe width="560" height="315" src="//www.youtube.com/embed/'+ code +'" frameborder="0" allowfullscreen></iframe>'
                );

			}
		});
	}

	editor.addButton('moloYoutube', {
	    image: url + '/img/youtube.gif',
		tooltip: 'youtube',
		onclick: showDialog,
		stateSelector: ['img[data-mce-object=video]', 'img[data-mce-object=iframe]']
	});


});